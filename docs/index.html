---

title: Cronos


keywords: fastai
sidebar: home_sidebar

summary: "A set of utilities to logs with time data in it and convert to trace event file format for a certain ADMS client timing log files and apache httpd access logs."
description: "A set of utilities to logs with time data in it and convert to trace event file format for a certain ADMS client timing log files and apache httpd access logs."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A very nice viewer for the trace event file can be found here <a href="https://ui.perfetto.dev/">https://ui.perfetto.dev/</a></p>
<p><img src="/cronos/assets/Screenshot1.png" alt="Example screenshot"></p>
<p>Format for the time event file can be found here <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview">https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The scipt can be found in cronos/convert_time_log.py  it shouldn't have dependencies outside the standard python libraries.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Examples of use,</p>
<p>This will generate a trace event file with the name <code>logs/ADMSClientTiming_07_12_2021.json</code></p>

<pre><code>python cronos/convert_time_log.py -f logs/ADMSClientTiming_07_12_2021.log</code></pre>
<p>To name the output file,</p>

<pre><code>python cronos/convert_time_log.py -f logs/ADMSClientTiming_07_12_2021.log -o example.json</code></pre>
<p>And to output to stdout</p>

<pre><code>python cronos/convert_time_log.py -f logs/ADMSClientTiming_07_12_2021.log -s</code></pre>
<p>For apache httpd logs</p>

<pre><code>python cronos/convert_time_log.py -a logs/access.log.2021-12-03 -o access.log.2021-12-03.json</code></pre>
<p>Then open and load the generated json file into the viewer at <a href="https://ui.perfetto.dev/">https://ui.perfetto.dev/</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Perfetto-Queries">Perfetto Queries<a class="anchor-link" href="#Perfetto-Queries"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When traces are loaded into the perfetto viewer, you can use the  Query(SQL) tool to filter on the trace data.</p>
<p>There seems to be two main tables created at loaded, <strong>slice</strong> and <strong>args</strong>, there may be more but have not looked at them.</p>
<p><strong><strong>slice</strong></strong> holds the event data and <strong><strong>args</strong></strong> holds all the parameters, joint on them using  <strong>arg_set_id</strong></p>
<p>Note <strong><strong>dur</strong></strong> is in nano seconds, divide by 10^9 to get seconds.</p>
<h3 id="Example-Queries">Example Queries<a class="anchor-link" href="#Example-Queries"> </a></h3><p>All events matching a specific name,</p>

<pre><code>select name, dur/1000000000.0,cat,a.string_value as event_time from slice s,args a where s.arg_set_id = a.arg_set_id  and
name like '/enmac/alarmevent%'
and a.flat_key = 'args.start';</code></pre>
<table>
<thead><tr>
<th>name</th>
<th>dur/1000000000.0</th>
<th>cat</th>
<th>event_time</th>
</tr>
</thead>
<tbody>
<tr>
<td>/enmac/alarmevent/config</td>
<td>1.978688</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:23.902474+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/defaultOwnershipFilter</td>
<td>0.239686</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:25.915164+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/alarms</td>
<td>2.348028</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:28.903655+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/config</td>
<td>0.672015</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:28.903655+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/defaultOwnershipFilter</td>
<td>0.220828</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:29.612597+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/config</td>
<td>1.4059788</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:29.880425+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/defaultOwnershipFilter</td>
<td>0.2460132</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:31.332394+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/config</td>
<td>0.628001</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:40.043329+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/defaultOwnershipFilter</td>
<td>0.2149871</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:40.711331+00:00</td>
</tr>
<tr>
<td>/enmac/alarmevent/config</td>
<td>0.30245</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:46:40.980319+00:00</td>
</tr>
</tbody>
</table>
<p>finding the max or min of a specific event name.</p>

<pre><code>select max(dur)/1000000000.0,min(dur)/1000000000.0 from slice where name like '/enmac/alarmevent%';</code></pre>
<table>
<thead><tr>
<th>max(dur)/1000000000.0</th>
<th>min(dur)/1000000000.0</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.348028</td>
<td>0.2136729</td>
</tr>
</tbody>
</table>
<p>Select the thing that takes the longest time</p>

<pre><code>select name,dur/1000000000.0,cat,string_value as event_time from slice s,args a 
where dur in (select  max(dur) from slice) and 
s.arg_set_id = a.arg_set_id and 
flat_key ='args.start';</code></pre>
<table>
<thead><tr>
<th>name</th>
<th>dur/1000000000.0</th>
<th>cat</th>
<th>event_time</th>
</tr>
</thead>
<tbody>
<tr>
<td>/enmac/swex/outages</td>
<td>100.025012</td>
<td>CreateDataSet</td>
<td>2021-12-07T17:54:12.262573+00:00</td>
</tr>
<tr>
<td><a href="https://trn1nms/enmac/swex/outages">https://trn1nms/enmac/swex/outages</a></td>
<td>100.025012</td>
<td>HttpWebRequest</td>
<td>2021-12-07T17:54:12.262573+00:00</td>
</tr>
</tbody>
</table>
<p>select all events where serverCPU is greater than 0.05seconds</p>

<pre><code>select distinct name,dur/1000000000.0 as 'duration(s)',category,real_value as serverCPU from 
slice s,args a 
where 
s.arg_set_id = a.arg_set_id and
key = 'args.serverCPU' and real_value &gt; 0.05;</code></pre>
<table>
<thead><tr>
<th>name</th>
<th>duration(s)</th>
<th>category</th>
<th>serverCPU</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://trn1nms/enmac/alarmevent/config">https://trn1nms/enmac/alarmevent/config</a></td>
<td>0.999992</td>
<td>HttpWebRequest</td>
<td>0.0703</td>
</tr>
<tr>
<td><a href="https://trn1nms/enmac/alarmevent/alarms">https://trn1nms/enmac/alarmevent/alarms</a></td>
<td>2.1509</td>
<td>HttpWebRequest</td>
<td>0.0656</td>
</tr>
<tr>
<td><a href="https://trn1nms/enmac/jobs/jobOperativeDetails">https://trn1nms/enmac/jobs/jobOperativeDetails</a></td>
<td>5.602695</td>
<td>HttpWebRequest</td>
<td>0.1953</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="perfectto-pivot-tables">perfectto pivot tables<a class="anchor-link" href="#perfectto-pivot-tables"> </a></h2><p>Enable this feature in the <strong>Support</strong> section on the LHS under <strong>flags</strong></p>
<p><img src="/cronos/assets/Pivot_query.png" alt="pivot table query screenshot"></p>
<p>results in a pivot table with the following columns</p>
<p><img src="/cronos/assets/pivot_table.png" alt="Pivot table screenshot"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Developing">Developing<a class="anchor-link" href="#Developing"> </a></h1><p>The script has been developed with nbdev as the markup/test env. See <a href="https://nbdev.fast.ai/tutorial.html">https://nbdev.fast.ai/tutorial.html</a> for more information.</p>
<p>Contributions are welcome.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="License">License<a class="anchor-link" href="#License"> </a></h1><p>Copyright 2021-present Bill Traill 3ideas.co.uk. Released under the terms of the MIT license.</p>
<p>If you're using the library in a commercial enviroment or product, please consider sponsoring its development or paying for maintenace of it. Contact bill@3ideas.co.uk</p>

</div>
</div>
</div>
</div>
 

